# Анализ данных розничного магазина с использованием PySpark
## Описание проекта:
Предоставлен датасет `retail_store_sales.csv`, который содержит информацию о транзакциях в розничном магазине. </br>
Он включает информацию о продажах из восьми товарных категорий, в каждой из которых по 25 товаров со статичными ценами. </br>
Датасет содержит пропущенные значения, несогласованные данные и ошибки.</br>
<ins>**Всего в таблице 11 столбцов:**</ins>
<img width="1087" height="658" alt="image" src="https://github.com/user-attachments/assets/80b69730-9773-49dd-98c7-49795588c588" />

## Задание:
### 1. Загрузить и предварительно обработать данные.</br>
1.1. <ins>Загрузить и вывести схему данных:</ins></br>
   - Загрузить файл `retail_store_sales.csv`.
   - Вывести первые 5 строк загруженного `DataFrame` и его схему (`df.printSchema()`).

1.2. <ins>Очистить названия столбцов:</ins></br>
   - Преобразовать названия всех столбцов к единому регистру - `snake_case`.
   - Вывевести обновленную схему `DataFrame` или названия столбцов, чтобы убедиться в изменении названий.

1.3. <ins>Преобразование типов данных:</ins></br>
   - Проанализировать к каким типам данных относятся данные в столбцах и привести столбцы к соответствующему типу. 

### 2. Очистка и валидация данных:</br>
   - Для наглядной оценки результата и отслеживания прогресса в процессе очистки данных рекомендуется после каждого основного этапа восстановления выводить количество пропусков в изменённых колонках. </br>
     Это поможет оценить эффективность каждого шага. Также можно показывать пример из 20 строк, где видно, как данные были восстановлены. Для этого можно использовать методы ._show()_ или ._limit()_.

2.1. <ins>Заполнение отсутствующие Price Per Unit:</ins></br>
   - Если  отсутствует цена за единицу товара, но общая сумма и количество имеются, вычислить цену за единицу товара и заполнить пропущенные значения.</br>
   - Результат округлить до двух знаков после запятой. </br>

2.2. <ins>Восстановление отсутствующих Item:</ins></br>
   - Так как данные статические для каждого товара, то необходимо составить справочник товаров в отдельный `DataFrame` со столбцами: `Category`, `Item` и `Price Per Unit`.</br>
   - Для транзакций, где отсутствует название товара, но имеется категория и цена, необходимо попытаться определить название товара, путём объединения (_join_) с загруженным справочником товаров.</br>
     
2.3. <ins>Заполнение отсутствующих `Quantity` и `Total Spent`:</ins></br>
   - Проверить, есть ли транзакции, с пропусками в `Total Spent`, но с данными в `Quantity` и `Price Per Unit`, если такие данные есть, то восстановить их.</br>
   - Аналогично проверить `Quantity`, если значения отсутствует, но имеются сумма транзакции и цена за товар , вычислите количество проданного товара и заполнить пропущенные значения.</br>
   - Результат привести к целому числу.</br>
     
2.4. <ins>Удалиние оставшихся строк с пропусками в `Category`, `Quantity`, `Total Spent` и `Price Per Unit`.</ins></br>

### 3. <ins>Разведочный анализ данных:</ins></br>
3.1. <ins>Самые популярные категории товаров:</ins></br>
    - Рассчитать общее количество проданных единиц товара для каждой категории.
    - Определить Топ-5 категорий по общему количеству проданных единиц.

3.2. <ins>Анализ среднего чека:</ins></br>
   - Рассчитать среднее значение `Total Spent` для каждого метода оплаты.</br>
   - Округлите до двух знаков после запятой.</br>
   - Рассчитать среднее значение `Total Spent` для каждой места где прошла оплата.</br>
   - Округлите до двух знаков после запятой.</br>    

### 4. <ins>Генерация признаков:</ins></br>
4.1. <ins>Временные признаки:</ins></br>
   - Добавить два новых столбца на основе `Transaction Date`:</br>
     a) `day_of_week`: День недели</br>
     b) `transaction_month`: Месяц транзакции
        
4.2. <ins>Продажи по дням недели:</ins></br>
   - Рассчитайте среднюю сумму продаж (`Total Spent`) для каждого дня недели.</br>
   - Выведите результаты, отсортированные по дням недели.</br>

4.3. <ins>Продажи по месяцам:</ins></br>
   - Рассчитайте среднюю сумму продаж (`Total Spent`)  для каждого месяца.</br>
   - Выведите результаты, отсортированные по месяцам.</br>

4.4. <ins>Признаки клиента:</ins></br>
   - Рассчитайте `customer_lifetime_value` (**CLV**) для каждого клиента как общую сумму (`Total Spent`), потраченную этим клиентом за все транзакции.  </br>
   - Выведите Топ-10 клиентов по их **CLV** (`customer_id` и их **CLV**).</br>
   
## Выполнение задания:
Задание выполнено с использованием **PySpark**. </br>
Все детали решения можно по шагам увидеть в файле **.ipynb** текущего репозитория. 
